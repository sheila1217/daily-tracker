<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>æ¯æ—¥ç´€éŒ„</title>
  <style>
    body { font-family: Arial; max-width: 600px; margin: auto; padding: 2em; }
    label { display: block; margin-top: 1em; }
    input, textarea, button { width: 100%; padding: 0.5em; margin-top: 0.3em; }
    .msg { margin-top: 1em; font-weight: bold; }
  </style>
</head>
<body>

<h2>æ¯æ—¥ç‡Ÿé¤Šé«”é‡ç´€éŒ„</h2>

<form id="recordForm">
  <label>æ—¥æœŸ <input type="date" name="date" required /></label>
  <label>é«”é‡ (kg) <input type="number" step="0.1" name="weight" required /></label>
  <label>ç†±é‡ (kcal) <input type="number" name="calories" required /></label>
  <label>è›‹ç™½è³ª (g) <input type="number" step="0.1" name="protein" required /></label>
  <label>ç¢³æ°´ (g) <input type="number" step="0.1" name="carbs" required /></label>
  <label>è„‚è‚ª (g) <input type="number" step="0.1" name="fat" required /></label>
  <label>é‹å‹•æ¶ˆè€— (kcal) <input type="number" name="exercise" /></label>
  <label>å‚™è¨» <textarea name="notes"></textarea></label>
  <button type="submit">é€å‡ºç´€éŒ„</button>
</form>

<div class="msg" id="msg"></div>

<script>
  document.querySelector('input[name="date"]').valueAsDate = new Date();

  const form = document.getElementById('recordForm');
  const msg = document.getElementById('msg');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    msg.textContent = 'å‚³é€ä¸­...';
    msg.style.color = 'black';

    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());

    // å°‡æ–‡å­—è½‰æ•¸å­—
    data.weight = parseFloat(data.weight);
    data.calories = parseInt(data.calories);
    data.protein = parseFloat(data.protein);
    data.carbs = parseFloat(data.carbs);
    data.fat = parseFloat(data.fat);
    data.exercise = data.exercise ? parseInt(data.exercise) : 0;

    try {
      const response = await fetch('https://script.google.com/macros/s/AKfycbxanHopL9LAdeTWqw0fG-F3uwTruQD6PkLz-DVR7oJlfYV9o0Q_sHJuCmUrXBifoQmn2g/exec', {
        method: 'POST',
        body: JSON.stringify(data),
        headers: { 'Content-Type': 'application/json' }
      });

      const result = await response.json();

      if (result.status === 'success') {
        msg.textContent = 'âœ… ç´€éŒ„æˆåŠŸï¼';
        msg.style.color = 'green';
        form.reset();
        form.date.valueAsDate = new Date();
      } else {
        msg.textContent = 'âŒ ç™¼ç”ŸéŒ¯èª¤ï¼š' + (result.message || 'æœªçŸ¥éŒ¯èª¤');
        msg.style.color = 'red';
      }
    } catch (err) {
      msg.textContent = 'ğŸŒ ç¶²è·¯éŒ¯èª¤ï¼Œç„¡æ³•é€å‡º';
      msg.style.color = 'red';
    }
  });
</script>

</body>
</html>
